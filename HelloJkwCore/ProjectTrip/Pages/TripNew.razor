@inherits JkwPageBase
@page "/trip/new"
@using KakaoMapBlazor

<KakaoMapComponent
    @ref="kakaoMapComponent"
    CreateOption="mapCreateOption"
    Style="width: 100%; height: 100%;"
></KakaoMapComponent>

<div style="width: 400px; top: 0; left: 0; z-index: 1; position: absolute;">
    <div style="padding: 15px;">
    <h3>새 여행 추가하기</h3>

    <MudForm @ref="_form" @bind-IsValid="FormSuccess">
        <MudTextField T="string" Label="여행 이름" @bind-Value="TripTitle"
            AutoFocus="true"
            Validation="@(new Func<string, IEnumerable<string>>(TripTitleValidator))"/>
        <MudTextField T="string" Label="여행 ID" @bind-Value="TripId"
            Validation="@(new Func<string, IEnumerable<string>>(TripIdValidator))"/>
        <MudDateRangePicker @bind-DateRange="DateRange" Label="여행 기간" DateFormat="yyyy.M.d dddd"/>
        <MudField Label="동반인">
            @foreach (var partner in TripPartners)
            {
                <MudChip OnClose="@(() => RemovePartner(partner))">@partner.DisplayName</MudChip>
            }
        </MudField>
        <MudAutocomplete T="AppUser" Label="동반인 추가" @bind-Value="searchPartner"
            SearchFunc="@SearchPartner"
            ToStringFunc="@(user => user?.DisplayName)"
            SelectOnClick="true"
            @onselect="OnPartnerSelect" />
        <MudField Label="대표 목적지" ErrorText="최소 1개 등록해주세요." Error="@(NewTrip.Positions?.Empty() ?? true)">
            @foreach (var pos in NewTrip.Positions)
            {
                <MudIcon Icon="@Icons.Filled.AddLocation" />
            }
        </MudField>
        <MudButton Disabled="@(!FormSuccessed)" OnClick="CreateTrip" Color="Color.Dark" Variant="Variant.Outlined">
            등록
        </MudButton>
    </MudForm>
    </div>
</div>

