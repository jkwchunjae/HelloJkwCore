@inherits JkwPageBase
@page "/sufc/schedule/new"

@using ProjectSuFc;

@inject ISuFcService SuFcService;

<h1>수FC / 일정 등록</h1>

<RadzenTemplateForm TItem="ScheduleData" Data="_schedule"
                    Submit="@(async () => await AddNewSchedule(_schedule))">
    <RadzenFieldset Text="일정 등록" Style="max-width: 700px;">
        <div class="row">
            <div class="col-3">
                <RadzenLabel Text="제목" />
            </div>
            <div class="col">
                <RadzenTextBox Name="Title" @bind-Value="_schedule.Title" />
            </div>
        </div>

        <div class="row">
            <div class="col-3">
                <RadzenLabel Text="날짜" />
            </div>
            <div class="col">
                <RadzenDatePicker Name="RegisterDate" @bind-Value="_schedule.Date" DateFormat="yyyy.MM.dd"/>
            </div>
        </div>

        <div class="row">
            <div class="col-3">
                <RadzenLabel Text="장소" />
            </div>
            <div class="col">
                <RadzenTextBox Name="Location" @bind-Value="_schedule.Location" />
            </div>
        </div>

        <div class="row">
            <div class="col-3">
                <RadzenLabel Text="시간" />
            </div>
            <div class="col">
                <RadzenTextBox Name="Time" @bind-Value="_schedule.Time" />
            </div>
        </div>
        <RadzenButton ButtonType="ButtonType.Submit" Text="등록" />
        <RadzenButton ButtonType="ButtonType.Button" Text="연속 등록" Click="@(async () => await AddNewSchedule(_schedule, gotoBack: false))" />
    </RadzenFieldset>
</RadzenTemplateForm>

@code
{
    ScheduleData _schedule = new();

    async Task AddNewSchedule(ScheduleData scheduleData, bool gotoBack = true)
    {
        var members = await SuFcService.GetAllMember();
        scheduleData.Members = members
            .Select(member => new ScheduleMember(member.Name))
            .ToList();

        await SuFcService.SaveSchedule(scheduleData);

        if (gotoBack)
        {
            Navi.NavigateTo("/sufc/schedule");
        }
        else
        {
            var newSchedule = new ScheduleData
            {
                Title = scheduleData.Title,
                Location = scheduleData.Location,
                Time = scheduleData.Time,
            };
            _schedule = newSchedule;
        }
    }
}
