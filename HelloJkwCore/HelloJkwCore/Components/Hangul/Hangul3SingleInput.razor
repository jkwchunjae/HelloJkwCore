@inherits JkwPageBase

<div class="@ContainerClass"
     style="@ContainerStyle"
     tabindex="0"
     @attributes="RootAttributes"
     @ref="containerRef"
     @onfocus="OnFocus"
     @onblur="OnBlur">
    <button type="button"
            class="hangul3-input__type-button"
            @onclick="ToggleTypeDropdown"
            @onclick:stopPropagation="true"
            @onmousedown:preventDefault="true"
            aria-haspopup="listbox"
            aria-expanded="@showTypeDropdown"
            aria-label="입력기 변경">
        <span class="sr-only">현재 입력기: @CurrentHangul3TypeDisplayName</span>
        <span class="hangul3-input__type-icon-main" aria-hidden="true">
            <svg viewBox="0 0 20 20" focusable="false">
                <path d="M4 6h10" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round" fill="none" />
                <path d="M4 10h8" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round" fill="none" />
                <path d="M4 14h12" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round" fill="none" />
                <circle cx="12" cy="6" r="1.6" fill="currentColor" />
                <circle cx="9" cy="10" r="1.6" fill="currentColor" />
                <circle cx="15" cy="14" r="1.6" fill="currentColor" />
            </svg>
        </span>
        <span class="hangul3-input__type-icon" aria-hidden="true">&#x25BE;</span>
    </button>
    <span class="text">
        @RenderSegments()
    </span>
    @if (showTypeDropdown)
    {
        <div class="hangul3-input__dropdown">
            @foreach (var option in Hangul3TypeOptions)
            {
                var activeClass = option == Hangul3Type ? " is-active" : string.Empty;
                <button type="button"
                        class="@($"hangul3-input__dropdown-item{activeClass}")"
                        @onclick="() => SelectHangul3Type(option)">
                    @GetHangul3TypeDisplayName(option)
                </button>
            }
        </div>
    }
</div>

<style>
    .hangul3-input {
        position: relative;
        display: inline-flex;
        align-items: center;
        min-width: 2ch;
        min-height: 1.5em;
        padding: var(--hangul3-padding, 5px 8px);
        border: var(--hangul3-border-width, 1px) solid var(--hangul3-border-color, #d1d5db);
        border-radius: var(--hangul3-border-radius, 4px);
        background-color: var(--hangul3-background-color, #ffffff);
        color: var(--hangul3-font-color, #111827);
        font-family: var(--hangul3-font-family, inherit);
        font-size: var(--hangul3-font-size, 15px);
        font-weight: var(--hangul3-font-weight, 500);
        line-height: 1.35;
        outline: none;
        cursor: text;
        box-sizing: border-box;
        transition: border-color 0.2s ease, box-shadow 0.2s ease, background-color 0.2s ease, color 0.2s ease;
        gap: var(--hangul3-gap, 6px);
    }

    .hangul3-input:focus,
    .hangul3-input:focus-visible {
        border-color: var(--hangul3-border-focus-color, #2563eb);
        box-shadow: 0 0 0 3px var(--hangul3-focus-shadow-color, rgba(37, 99, 235, 0.2));
    }

    .hangul3-input__type-button {
        display: inline-flex;
        align-items: center;
        gap: 4px;
        padding: 2px 6px;
        border: none;
        border-radius: 4px;
        background: var(--hangul3-type-button-background, #f3f4f6);
        color: inherit;
        font: inherit;
        cursor: pointer;
        transition: background-color 0.2s ease, color 0.2s ease;
    }

    .hangul3-input__type-button:hover,
    .hangul3-input__type-button:focus {
        background: var(--hangul3-type-button-hover-background, #e5e7eb);
        outline: none;
    }

    .hangul3-input__type-icon {
        font-size: 0.75em;
        line-height: 1;
    }

    .hangul3-input__type-icon-main {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 1.1em;
        height: 1.1em;
    }

    .hangul3-input__type-icon-main svg {
        width: 100%;
        height: 100%;
        display: block;
    }

    .hangul3-input .text {
        white-space: pre-wrap;
        flex: 1 1 auto;
        min-height: 1em;
    }

    .hangul3-input .caret {
        display: inline-block;
        width: var(--hangul3-caret-width, 1px);
        background: var(--hangul3-caret-color, currentColor);
        height: 1em;
        vertical-align: text-bottom;
        animation: blink 1s step-start 0s infinite;
    }

    .hangul3-input .selection {
        background: var(--hangul3-selection-color, #bfdbfe);
    }

    .hangul3-input .composing {
        text-decoration: underline;
    }

    .hangul3-input__dropdown {
        position: absolute;
        top: calc(100% + 4px);
        left: 0;
        z-index: 5;
        display: flex;
        flex-direction: column;
        padding: 4px;
        border-radius: 6px;
        background: var(--hangul3-dropdown-background, #ffffff);
        border: 1px solid var(--hangul3-dropdown-border-color, #d1d5db);
        box-shadow: 0 8px 16px rgba(15, 23, 42, 0.08);
        min-width: 160px;
    }

    .hangul3-input__dropdown-item {
        padding: 6px 8px;
        border: none;
        background: transparent;
        font: inherit;
        text-align: left;
        border-radius: 4px;
        cursor: pointer;
        color: inherit;
        transition: background-color 0.15s ease, color 0.15s ease;
    }

    .hangul3-input__dropdown-item:hover,
    .hangul3-input__dropdown-item:focus {
        background: var(--hangul3-dropdown-hover-background, #e5e7eb);
        outline: none;
    }

    .hangul3-input__dropdown-item.is-active {
        background: var(--hangul3-dropdown-active-background, #dbeafe);
        color: var(--hangul3-dropdown-active-color, #1d4ed8);
        font-weight: 600;
    }

    .hangul3-input .sr-only {
        position: absolute;
        left: -10000px;
        top: auto;
        width: 1px;
        height: 1px;
        overflow: hidden;
    }

    .hangul3-input--dark {
        --hangul3-background-color: #1f2937;
        --hangul3-font-color: #f9fafb;
        --hangul3-border-color: #4b5563;
        --hangul3-border-focus-color: #60a5fa;
        --hangul3-focus-shadow-color: rgba(96, 165, 250, 0.35);
        --hangul3-caret-color: #f9fafb;
        --hangul3-selection-color: rgba(96, 165, 250, 0.35);
    }

    @@keyframes blink {
        0% {
            opacity: 1;
        }

        50% {
            opacity: 0;
        }

        100% {
            opacity: 1;
        }
    }
</style>
