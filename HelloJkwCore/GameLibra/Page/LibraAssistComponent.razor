@inherits JkwPageBase
@using MudBlazor

@if (Sets != null)
{
<MudTable Items="@Sets" Dense="true">
    <HeaderContent>
        @foreach (var cubeName in CubeNames)
        {
            <MudTh>@cubeName</MudTh>
        }
        @foreach (var scale in State.Scales)
        {
            var leftName = $"L{scale.Id}";
            var rightName = $"R{scale.Id}";
            <MudTh>@leftName</MudTh>
            <MudTh>@rightName</MudTh>
        }
        <MudTh>
            <MudTextField T="string" Value="calcFormula" ValueChanged="FormulaChagned" Immediate="true"/>
        </MudTh>
    </HeaderContent>
    <RowTemplate>
        @foreach (var cubeName in CubeNames)
        {
            var value = context[cubeName];
            <MudTd>@value</MudTd>
        }
        @foreach (var scale in State.Scales)
        {
            var leftName = $"L{scale.Id}";
            var rightName = $"R{scale.Id}";
            var leftValue = scale.Left.Cubes.Sum(c => context[c.Name]);
            var rightValue = scale.Right.Cubes.Sum(c => context[c.Name]);
            <MudTd>@leftValue</MudTd>
            <MudTd>@rightValue</MudTd>
        }
        @if (calcResult.ContainsKey(context))
        {
            var result = calcResult[context];
            if (result is Boolean rBool && rBool == true)
            {
                <MudTd style="background-color: #3dc03d; color: white;">
                    @result
                </MudTd>
            }
            else if (result is Boolean rBool2 && rBool2 == false)
            {
                <MudTd style="background-color: #ff5d2c; color: white;">
                    @result
                </MudTd>
            }
            else
            {
                <MudTd>
                    @result
                </MudTd>
            }
        }
        else
        {
            <MudTd></MudTd>
        }
    </RowTemplate>
</MudTable>
}
else
{
    var count = AssistSets?.Count() ?? 0;
<span>
    너무 많은 경우가 있습니다. 1000개 이하로 줄어들면 표시됩니다. 현재 @count
</span>
}