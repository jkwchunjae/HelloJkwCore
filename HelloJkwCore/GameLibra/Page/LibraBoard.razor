@inherits JkwPageBase
@page "/game/libra/room/{GameId}"
@using MudBlazor

@if (_state != null)
{
<MudDropContainer T="DropCubeItem" Items="_cubes"
    Class="mud-border-lines-default"
    ItemsSelector="@((item, dropzone) => item.Identifier == dropzone)"
    ApplyDropClassesOnDragStarted="false"
    CanDropClass="mud-border-info"
    NoDropClass="mud-border-error"
    CanDrop="CanDrop"
    ItemDropped="ItemDropped"
>
    <ChildContent>
        <div class="board">
            <div class="scales d-flex">
                @foreach (var scale in _state.Scales)
                {
                    <ScaleComponent
                        Scale="@scale"
                        CurrentPlayer="_currentPlayer"
                        />
                }
            </div>
            @if (_state.Status == LibraGameStatus.Ready)
            {
            <div>
                <MudButton Size="Size.Large" Variant="Variant.Filled" Color="Color.Success"
                    OnClick="Start"
                >
                    !! 시작 !!
                </MudButton>
            </div>
            }
            @if (_state.Status == LibraGameStatus.Playing)
            {
                <div>
                @if (_currentPlayer?.LinkedUser == User)
                {
                    <MudButton Size="Size.Large" Variant="Variant.Filled" Color="Color.Error"
                        OnClick="Confirm"
                    >
                        !! 확정 !!
                    </MudButton>
                }
                else
                {
                    <MudButton Size="Size.Large" Variant="Variant.Filled" Color="Color.Default"
                        Disabled="true"
                    >
                        상대방을 기다리고 있습니다.
                    </MudButton>
                }
                </div>
            }
            @if (_state.Status == LibraGameStatus.Failed)
            {
                <MudButton Size="Size.Large" Variant="Variant.Filled"
                    Disabled="true"
                >
                    !! 실패 ㅋ !!
                </MudButton>
            }
            @if (_state.Status == LibraGameStatus.Success)
            {

            }
            <div class="players">
                @foreach (var player in _state.Players)
                {
                    var p = player;
                    <PlayerComponent
                        @bind-Player="p"
                        GameEngine="_gameEngine"
                        CurrentPlayerId="_state.CurrentPlayerId"
                    />
                }
            </div>
        </div>
    </ChildContent>
    <ItemRenderer>
        @{
            var color = $"cube-color-{context.Cube.Id}";
        }
        <span class="cube-item @color">@context.Cube.Id</span>
    </ItemRenderer>
</MudDropContainer>
}

