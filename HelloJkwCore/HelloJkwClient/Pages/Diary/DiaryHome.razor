@inherits JkwPageBase

@page "/diary"
@page "/diary/{DiaryName}/{DateStr}"

@using Common
@using HelloJkwService.Diary

@if (!IsAuthenticated)
{
    <span>로그인하세요.</span>
}
else if ((DiaryInfo?.IsSecure ?? false) && Password == string.Empty)
{
    <span>비밀번호를 입력하세요</span>
    <form @onsubmit="@(_ => SetPassword())">
        <RadzenPassword @bind-Value="Password" />
    </form>
}
else if (CurrentDiary.Any(x => x.IsSecure))
{
    <pre>복호화 하지 못했습니다. 비밀번호를 다시 입력해주세요.</pre>
    <button @onclick="@(_ => ResetPassword())">비밀번호 재설정</button>
}
else if (HasDiary)
{
    <h2>@DiaryDate.ToString("yyyy.MM.dd") <span class="smaller">@DiaryDate.GetWeekday(DateLanguage.KR, WeekdayFormat.D)</span></h2>

    @foreach (var diary in CurrentDiary)
    {
        <pre>@diary.Text</pre>
    }

    @if (CurrentDiary.FirstOrDefault().HasPrev(out var prevDate))
    {
        <button @onclick="@(_ => GotoDiary(DiaryInfo.DiaryName, prevDate))">
            이전
        </button>
    }

    @if (CurrentDiary.FirstOrDefault().HasNext(out var nextDate))
    {
        <button @onclick="@(_ => GotoDiary(DiaryInfo.DiaryName, nextDate))">
            다음
        </button>
    }

    @if (IsMyDiary)
    {
        <button @onclick="@(_ => WriteDiary())">쓰기</button>
        <button @onclick="@(_ => EditDiary())">수정</button>
        <button @onclick="@(_ => ShowDiaryList())">목록</button>
        <button @onclick="@(_ => DiarySearch())">검색</button>
        @if (DiaryInfo.IsSecure)
        {
            <button @onclick="@(_ => ResetPassword())">비밀번호 재설정</button>
        }
    }
}
else if (!HasDiary)
{
    <span>일기장을 만드세요</span>
    <RadzenButton Click="@(_ => WriteDiary())">쓰기</RadzenButton>
}
else
{
    <span>로그인하세요.</span>
}

